# GitGuard Codex - Production Environment Configuration
# Zero-drama rollout: Phase 3 - Full Production Deployment
# Flip flag; leave JetStream retention unbounded for 72h to allow replays; then set sane retention

# Core Codex Settings - All features enabled
CODEX_PUBLISH_ENABLED=true
CODEX_PUBLISH_PORTAL=external
CODEX_EMBEDDINGS_ENABLED=false
CODEX_OWNERS_ENABLED=false

# Database Configuration
DATABASE_URL=postgresql+psycopg://codex_prod:${CODEX_PROD_DB_PASSWORD}@localhost:5432/codex_production

# JetStream Configuration - Initial 72h unbounded, then sane limits
# Phase 3a: Unbounded retention for 72h replay capability
JETSTREAM_URL=nats://localhost:4222
JETSTREAM_STREAM=codex-production
JETSTREAM_RETENTION_POLICY=limits
JETSTREAM_MAX_AGE=72h
JETSTREAM_MAX_MSGS=-1
JETSTREAM_MAX_BYTES=-1

# Phase 3b: Sane retention limits (activate after 72h)
# Uncomment these after initial 72h period:
# JETSTREAM_MAX_AGE=24h
# JETSTREAM_MAX_MSGS=1000000
# JETSTREAM_MAX_BYTES=10GB

# Repository Configuration - All repos enabled
CODEX_REPO_INCLUDE_LIST=
CODEX_REPO_EXCLUDE_LIST=

# Production Performance Settings
MAX_CONCURRENT_BUILDS=20
BUILD_TIMEOUT=900s
MAX_REPOS_PER_HOUR=500

# Publishing Configuration
DOCS_BUILD_ENABLED=true
DOCS_PUBLISH_ENABLED=true
DOCS_PUBLISH_URL=${CODEX_DOCS_BASE_URL}

# Production Monitoring
LOG_LEVEL=WARN
METRICS_ENABLED=true
METRICS_PORT=9092
ALERT_WEBHOOK_URL=${PROD_ALERT_WEBHOOK}

# Production Feature Toggles
CODEX_DEBUG_MODE=false
CODEX_DRY_RUN=false
CODEX_CANARY_MODE=false
CODEX_ROLLBACK_ENABLED=true

# High Availability Settings
CODEX_HA_ENABLED=true
CODEX_REPLICA_COUNT=3
CODEX_HEALTH_CHECK_INTERVAL=30s

# Performance and Reliability
CODEX_PERFORMANCE_TRACKING=true
CODEX_ERROR_RATE_THRESHOLD=0.01
CODEX_LATENCY_THRESHOLD_MS=3000
CODEX_CIRCUIT_BREAKER_ENABLED=true

# Backup and Recovery
CODEX_BACKUP_ENABLED=true
CODEX_BACKUP_INTERVAL=6h
CODEX_BACKUP_RETENTION=7d
