# GitGuard Codex - Canary Environment Configuration
# Zero-drama rollout: Phase 2 - Canary Deployment
# Enable publish for 10% of repos (env include list)

# Core Codex Settings
CODEX_PUBLISH_ENABLED=true
CODEX_PUBLISH_PORTAL=external
CODEX_EMBEDDINGS_ENABLED=false
CODEX_OWNERS_ENABLED=false

# Database Configuration
DATABASE_URL=postgresql+psycopg://codex_canary:${CODEX_CANARY_DB_PASSWORD}@localhost:5432/codex_canary

# JetStream Configuration - Unbounded retention for 72h replay capability
JETSTREAM_URL=nats://localhost:4222
JETSTREAM_STREAM=codex-canary
JETSTREAM_RETENTION_POLICY=limits
JETSTREAM_MAX_AGE=72h
JETSTREAM_MAX_MSGS=-1
JETSTREAM_MAX_BYTES=-1

# Canary Repository Selection (10% of total repos)
# Update this list with specific repositories for canary testing
CODEX_REPO_INCLUDE_LIST=gitguard/platform-core,gitguard/api-gateway,gitguard/auth-service,gitguard/notification-service,gitguard/metrics-collector
CODEX_REPO_EXCLUDE_LIST=

# Canary Safety Limits
MAX_CONCURRENT_BUILDS=5
BUILD_TIMEOUT=600s
MAX_REPOS_PER_HOUR=50

# Publishing Configuration
DOCS_BUILD_ENABLED=true
DOCS_PUBLISH_ENABLED=true
DOCS_PUBLISH_URL=${CODEX_DOCS_BASE_URL}

# Monitoring and Alerting
LOG_LEVEL=INFO
METRICS_ENABLED=true
METRICS_PORT=9091
ALERT_WEBHOOK_URL=${CANARY_ALERT_WEBHOOK}

# Canary-specific Feature Toggles
CODEX_DEBUG_MODE=false
CODEX_DRY_RUN=false
CODEX_CANARY_MODE=true
CODEX_ROLLBACK_ENABLED=true

# Performance Monitoring
CODEX_PERFORMANCE_TRACKING=true
CODEX_ERROR_RATE_THRESHOLD=0.05
CODEX_LATENCY_THRESHOLD_MS=5000